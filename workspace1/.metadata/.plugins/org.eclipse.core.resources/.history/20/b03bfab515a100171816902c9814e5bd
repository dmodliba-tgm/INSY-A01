package jdbcdemo;

import java.util.*;
import java.sql.*;
import java.io.*;
	
public class FlughafenDAO {

	private Connection myConn;
	
	public FlughafenDAO() throws Exception {
		
		Properties props = new Properties();
		props.load(new FileInputStream("flightdata.properties"));
		
		String user = props.getProperty("user");
		String password = props.getProperty("password");
		String dburl = props.getProperty("dburl");	
		
		myConn = DriverManager.getConnection(dburl, user, password);
		
		System.out.println("DB conncetion successful to: " + dburl);	
	}
	
	public List<Flughaefen> getAllFlughaefen() throws Exception {
		List <Flughaefen> list = new ArrayList<>();
		
		Statement myStmt = null;
		ResultSet myRs = null;
		
		try {
			myStmt = myConn.createStatement();
			myRs = myStmt.executeQuery("select * from airports");
			
			while (myRs.next()) {
				Flughaefen tempFlughaefen = convertRowToFlughaefen(myRs);
				list.add(tempFlughaefen);
			}
			
			return list;
		}
		finally {	
			close(myStmt, myRs);
		}
	}
	
	private Flughaefen convertRowToFlughaefen(ResultSet myRs) throws SQLException {
		
		String airportcode = myRs.getString("airportcode");
		String name = myRs.getString("name");
		String country = myRs.getString("country");
		String city = myRs.getString("city");
		
		Flughaefen tempFlughaefen = new Flughaefen(airportcode, name, country, city);
		
		return tempFlughaefen;
	}
	
}
